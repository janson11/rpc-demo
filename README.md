# rpc-demo
rpc实践与核心原理

## 1、核心原理

- 什么是RPC？

  RPC全称：Remote Procedure Call即远程过程调用。

- RPC作用：

  屏蔽远程调用跟本地调用的区别，让我们感觉就是调用项目的内的方法。

  隐藏底层网络通信的复杂性，让我们更专注于业务逻辑。

- RPC流程

    

![ ](C:\Users\janso\Pictures\RPC\RPC调用完整流程图.png)

- 思考
RPC不直接用HTTP协议的一个原因是无法实现请求跟响应关联。每次请求都需要重新建立连接，响应完成后再关闭连接，所以需要设计私有协议。那么在RPC里面，我们是怎么实现请求跟响应关联呢？
请求时带上消息id。

## 2、序列化

网络传输的数据必须是二进制数据，但调用方请求的出入参数都是对象。对象不能直接在网络中传输的，所以我们需要提前把它转成可传输的二进制，并且要求转换算法是可逆的，这个过程我们一般叫作"序列化"。这时，服务提供方就可以正确地从二进制数据中分割出不同的请求，同时根据请求类型和序列化类型，把二进制的消息体逆向还原成请求对象，这个过程我们称之为"反序列化"；

常用序列化：

- JDK原生序列化

- JSON：JSON进行序列化的额外空间开销比较大，对于大数据量服务这意味着需要巨大的内存和磁盘开销。

  ​            JSON没有类型，但像Java这种强类型语言，需要通过反射统一解决，所以性能不会太好。

 - Hessian：动态类型、二进制、紧凑的，并且可跨语言移植的一种序列化框架。Hessian协议要比JDK、JSON更加紧凑，性能上要比JDK、JSON序列化高效很多，而且生成的字节数也更小。

 -  Protobuf：序列化后体积相比JSON、Hessian小很多。

     序列化反序列化速度很快，不需要通过反射获取类型。

    消息格式升级和兼容性不错，可以做到向后兼容。

在使用RPC框架的过程中，我们构造入参、返回值对象，主要记住以下几点：

1、对象要尽量简单，没有太多的依赖关系，属性不要太多，尽量高内聚。

2、入参对象与返回值对象体积不要太大，更不要传太大的集合。

3、尽量使用简单的、常用的开发语言原生的对象，尤其是集合类。

4、对象不要有复杂的继承关系，最好不要有父子类的情况。